var mo=Object.defineProperty;var ho=(e,t,a)=>t in e?mo(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a;var Y=(e,t,a)=>(ho(e,typeof t!="symbol"?t+"":t,a),a);const fo=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))r(d);new MutationObserver(d=>{for(const l of d)if(l.type==="childList")for(const q of l.addedNodes)q.tagName==="LINK"&&q.rel==="modulepreload"&&r(q)}).observe(document,{childList:!0,subtree:!0});function a(d){const l={};return d.integrity&&(l.integrity=d.integrity),d.referrerpolicy&&(l.referrerPolicy=d.referrerpolicy),d.crossorigin==="use-credentials"?l.credentials="include":d.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function r(d){if(d.ep)return;d.ep=!0;const l=a(d);fetch(d.href,l)}};fo();const sa=document.getElementById("loadingScreen"),ct=document.getElementById("loadingScreenClickText"),ia=e=>{ct.textContent=e},la=()=>{sa.classList.add("hide")},xo=()=>{sa.classList.remove("hide")},Aa=()=>{ct.classList.remove("hide")},qo=()=>{ct.classList.add("hide")};var bo="data:audio/mpeg;base64,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";class pt{constructor(t){Y(this,"source");Y(this,"isPlaying");this.source=new Audio,this.source.src=t,this.isPlaying=!1}play(){throw'method "play" must be implemented'}pause(){throw'method "pause" must be implemented'}stop(){throw'method "stop" must be implemented'}loop(t){throw'method "loop" must be implemented'}}class yo extends pt{constructor(a){super(a);Y(this,"channel");this.channel=this.source}play(){this.isPlaying=!0,this.channel.play(),this.channel.onended=()=>{this.isPlaying=!1}}pause(){this.isPlaying=!1,this.channel.pause()}stop(){this.pause(),this.channel.currentTime=0}loop(a){this.channel.loop=a}}class vo extends pt{constructor(a){super(a);Y(this,"channels");this.channels=new Set}checkTrackPaused(){return this.isPlaying}checkChannelsExist(){return this.channels.size>0}resume(){[...this.channels.values()].forEach(a=>{a.play()}),this.isPlaying=!0}playNewChannel(){const a=new Audio;a.src=this.source.src,this.channels.add(a),a.onended=()=>{this.channels.delete(a),this.channels.size===0&&(this.isPlaying=!1)},this.isPlaying=!0,a.play()}play(){!this.checkTrackPaused()&&this.checkChannelsExist()?this.resume():this.playNewChannel()}pause(){this.isPlaying=!1,[...this.channels.values()].forEach(a=>{a.pause()})}stop(){this.isPlaying=!1,[...this.channels.values()].forEach(a=>{a.pause(),this.channels.delete(a)})}}class da{constructor(){Y(this,"audios");this.audios=new Map,this.play=this.play.bind(this),this.pause=this.pause.bind(this),this.stop=this.stop.bind(this)}getTrackExist(t){return this.audios.has(t)}checkTrackExist(t){if(!this.getTrackExist(t))throw`track - ${t} doesn't exist`;return!0}checksBeforePlay(t){return this.checkTrackExist(t)}checkTrackDuplicate(t){if(this.getTrackExist(t))throw`track - ${t} already exist`}createTrack(t){return new pt(t)}addTrack(t,a){this.audios.set(t,a)}add(t,a,r){this.checkTrackDuplicate(t);const d=this.createTrack(a);this.addTrack(t,d)}play(t){if(!this.checksBeforePlay(t))return;const a=this.audios.get(t);return a.play(),a}loop(t,a){this.audios.get(t).loop(a)}pause(t){const a=this.audios.get(t);return a.pause(),a}stop(t){const a=this.audios.get(t);return a.stop(),a}vol(t,a=1){const r=this.audios.get(t);r.source.volume=a}}class wo extends da{createTrack(t){return new yo(t)}checkTrackAlreadyPlaying(t){return this.audios.get(t).isPlaying}checksBeforePlay(t){return super.checksBeforePlay(t)&&!this.checkTrackAlreadyPlaying(t)}}class ko extends da{createTrack(t){return new vo(t)}}const be=new ko;be.add("menuButtonHover",bo);var Bo="./assets/wall_btn_press.88453b56.mp3",So="./assets/wall_btn_unpress.a8f1d7d9.mp3",Mo="./assets/wallOpen.6cf2272c.mp3",Eo="./assets/lvlBg1.7085f06f.mp3",Co="./assets/lvlBg2.2ece8d06.mp3",Wo="./assets/lvlBg3.92d578d2.mp3",Yo="./assets/lvlBg4.9237c997.mp3",Io="data:audio/mpeg;base64,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",To="./assets/pickingSword.ad897c7e.mp3",Po="data:audio/mpeg;base64,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",Lo="./assets/torch1.8dd79653.mp3",Xo="./assets/bugSound1.3949f28e.mp3",Ro="./assets/portalRoomSound.969c769e.mp3",Oo="./assets/scrollOpen.4031edff.mp3",Zo="./assets/closeScroll.39d7e076.mp3",Qo="./assets/pickingSpell.8b8a6f94.mp3",Fo="./assets/transformSpell.94005411.mp3",Go="./assets/healSpell.c3b92eef.mp3",zo="./assets/notEnoughMana.21d0e1d2.mp3",Do="./assets/awakening.e912cded.mp3",Uo="./assets/lvlEnd.37ef2b3c.mp3",jo="data:audio/mpeg;base64,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",No="./assets/menuBg.5b597f27.mp3",Vo="./assets/glassWallSound.d474d607.mp3";const m=new wo;m.add("wall_btn_press",Bo);m.add("wall_btn_unpress",So);m.add("wall_opening",Mo);m.add("lvlBg1",Eo);m.add("lvlBg2",Co);m.add("lvlBg3",Wo);m.add("lvlBg4",Yo);m.add("playerSteps1",Io);m.add("pickingSword",To);m.add("swordAttack",Po);m.add("torch1",Lo);m.add("bugSound1",Xo);m.add("portalRoomSound",Ro);m.add("scrollRead",Oo);m.add("scrollClose",Zo);m.add("pickingSpell",Qo);m.add("transformSpell",Fo);m.add("healSpell",Go);m.add("notEnoughMana",zo);m.add("awakeningOST",Do);m.add("lvlEnd",Uo);m.add("menuButtonClick",jo);m.add("menuBg",No);m.add("glassWallSound",Vo);let ca=0,pa=0,ga=0,ua=0,ma=0,ha=0,fa=0;const ne=()=>ca,se=()=>pa,xa=()=>ga,de=e=>{ca=e},ce=e=>{pa=e},gt=e=>{ga=e},qa=()=>ua,ba=()=>ma,Ho=()=>ha,ya=()=>fa,Jo=e=>{ua=e},Ko=e=>{ma=e},_o=e=>{ha=e},$o=e=>{fa=e};let va=0,wa=0,ka=0;const en=({x:e,y:t,z:a})=>{va=e,wa=t,ka=a},Ba=()=>ne()-va,tn=()=>xa()-wa,Sa=()=>se()-ka,ae=e=>e>360?e-360:e<0?e+360:e,ut=e=>{let t;return e<=90?t=an(e):e<=180?t=rn(e):e<=270?t=on(e):e<=360&&(t=nn(e)),t},an=e=>{const t=e/90*-1,a=1+t;return{x:t,z:a}},rn=e=>{const t=(e/90-1)*-1;return{x:(1+t)*-1,z:t}},on=e=>{const t=e/90-2,a=(1-t)*-1;return{x:t,z:a}},nn=e=>{const t=e/90-3;return{x:1-t,z:t}};class Z{constructor(){Y(this,"subscribers");this.subscribers=[]}subscribe(t){this.subscribers.push(t)}unsubscribe(t){this.subscribers=this.subscribers.filter(a=>a!==t)}broadcast(t){this.subscribers.forEach(a=>a(t))}}const Ma=new Z,mt=({movementX:e,movementY:t})=>{const a=e,r=t,d=qa()-a,l=ba()-r,q=ae(Ho()-a),k=ae(ya()-r);Ma.broadcast({newRealAngleX:d,newRealAngleY:l,newNormalizedAngleX:q,newNormalizedAngleY:k,movementX:e,movementY:t})},sn=()=>{document.addEventListener("mousemove",mt)},ln=()=>{document.removeEventListener("mousemove",mt)},An=({x:e,y:t,z:a,angleX:r,angleY:d})=>{de(e),gt(t),ce(a),en({x:e,y:t,z:a}),mt({movementX:r,movementY:d})},dn=800,cn=16,pn=687,gn=0,un=0;An({x:dn,y:cn,z:pn,angleX:gn,angleY:un});const ye=new Map,R=(e,t)=>{ye.set(e,t)},ve=e=>{ye.delete(e)},Ea=e=>{const t=ye.get(e);if(!t)throw`unknown item - ${e}`;t.isActive=!1},mn=()=>ye.entries(),hn=()=>{ye.forEach(e=>{e.deactivationCallback(),e.isActive=!1})},ht=document.getElementById("activeItemTips"),H=e=>{fn(e),xn()},fn=e=>{ht.textContent=e},xn=()=>{ht.classList.remove("hide")},L=()=>{ht.classList.add("hide")},ft=new Z,xt=document.querySelector("#room1 .wallBtnWrap"),qn=()=>{ve("room1WallBtn"),Wa(),L()},Ca=({code:e})=>{e==="KeyE"&&(xt.classList.add("pressed"),m.play("wall_btn_press"),qn(),ft.broadcast())},bn=()=>{xt.classList.add("active"),document.addEventListener("keydown",Ca),H("press E")},Wa=()=>{xt.classList.remove("active"),document.removeEventListener("keydown",Ca),L()};R("room1WallBtn",{isActive:!1,maxX:1900,minX:1350,maxZ:650,minZ:350,activationCallback:bn,deactivationCallback:Wa});const yn=document.querySelector("#room5 .bulkWallWrap"),vn=()=>{yn.classList.add("open"),setTimeout(()=>{m.play("wall_opening")},2e3)};ft.subscribe(vn);const wn=(e,t)=>Math.random()*(t-e)+e|0;let it;const kn=e=>{it=e};let Ya;const Bn=()=>{const e=it[wn(0,it.length)];m.play(e)},Sn=()=>{Ya=setInterval(Bn,4e4)},Mn=()=>{clearInterval(Ya)};kn(["lvlBg1","lvlBg2","lvlBg3","lvlBg4"]);const En=15;let Ia=15,Ta=15,Pa=0,La=1,Xa=0,Ra=1,Oa=0,Za=0;const Qa=()=>En,P=()=>({stepSizeX:Ia,stepSizeZ:Ta}),zt=()=>({forwardStepCoefX:Pa,forwardStepCoefZ:La}),Dt=()=>({backwardStepCoefX:Xa,backwardStepCoefZ:Ra}),Ye=()=>({sideStepCoefX:Oa,sideStepCoefZ:Za}),Qe=e=>{Ia=e},Fe=e=>{Ta=e},Cn=e=>{Pa=e},Wn=e=>{La=e},Yn=e=>{Xa=e},In=e=>{Ra=e},Tn=e=>{Oa=e},Pn=e=>{Za=e};class Fa extends Z{constructor(a){super();Y(this,"movementId");Y(this,"direction");Y(this,"curMoveCallback");Y(this,"directionHandlers");Y(this,"move",()=>{this.movementId=requestAnimationFrame(this.move),this.curMoveCallback()});this.movementId=null,this.direction=null,this.curMoveCallback=null,this.directionHandlers=a}initMove(a){this.direction=a,this.curMoveCallback=this.directionHandlers[this.direction],this.movementId=requestAnimationFrame(this.move)}stopMove(){this.broadcast({state:!1,direction:this.direction}),this.direction=null,cancelAnimationFrame(this.movementId)}startMove(a){this.direction!==a&&(this.stopMove(),this.initMove(a),this.broadcast({state:!0,direction:a}))}}const Ln=()=>{ce(se()+P().stepSizeZ*zt().forwardStepCoefZ|0),de(ne()+P().stepSizeX*zt().forwardStepCoefX|0)},Xn=()=>{ce(se()+P().stepSizeZ*Dt().backwardStepCoefZ|0),de(ne()+P().stepSizeX*Dt().backwardStepCoefX|0)},Rn={forward:Ln,backward:Xn},re=new Fa(Rn),On=()=>{de(ne()+P().stepSizeX*Ye().sideStepCoefX|0),ce(se()+P().stepSizeZ*Ye().sideStepCoefZ|0)},Zn=()=>{de(ne()-P().stepSizeX*Ye().sideStepCoefX|0),ce(se()-P().stepSizeZ*Ye().sideStepCoefZ|0)},Qn={right:On,left:Zn},oe=new Fa(Qn),xe=document.getElementById("movementBar");let We;const Ga=e=>{e&&xe.classList.remove(e),We=e,xe.classList.add(e)},za=()=>{xe.classList.remove("hide")},Da=()=>{xe.classList.add("hide"),We&&(xe.classList.remove(We),We=null)},qt=new Z,Ie=Qa()/1.5;let bt=!0,le=!1;const Ua=()=>le,Fn=()=>{!bt||(le=!0,Fe(P().stepSizeZ+Ie),Qe(P().stepSizeX+Ie),qt.broadcast(le),Ga("run"),za())},ja=()=>{le=!1,Fe(P().stepSizeZ-Ie),Qe(P().stepSizeX-Ie),qt.broadcast(le),Da()},Gn=()=>{bt=!1,le&&ja()},zn=()=>{bt=!0},Dn=100,Na=200;let qe,lt=Na,yt=!0;const Un=()=>{yt=!0},jn=()=>{yt=!1},Nn=()=>{!yt||m.play("playerSteps1")},Va=()=>{qe=setInterval(Nn,lt)},Ha=()=>{clearInterval(qe),qe=void 0},_e=new Set,Ja=({state:e,direction:t})=>{if(e){if(_e.add(t),qe)return;Va()}else{if(_e.delete(t),_e.size)return;Ha()}},Vn=e=>{e?lt=Dn:lt=Na,qe&&(Ha(),Va())};re.subscribe(Ja);oe.subscribe(Ja);qt.subscribe(Vn);const Ka=document.querySelector("#room3 .protectionOpacityWall"),Hn=()=>{Ka.style.webkitMaskImage="radial-gradient(transparent 0%, black 15%)"},Jn=()=>{Ka.style.webkitMaskImage="radial-gradient(transparent 0%, black 0%)"};R("secretWallFar",{isActive:!1,maxX:900,minX:450,maxZ:2100,minZ:1300,activationCallback:Hn,deactivationCallback:Jn});let _a,$a;const Kn=()=>_a,_n=()=>$a,$n=e=>{$a=e},es=e=>{_a=e},er=new Z,tr=()=>{const e=visualViewport.height!==Kn(),t=visualViewport.width!==_n();es(visualViewport.height),$n(visualViewport.width),er.broadcast({height:visualViewport.height,width:visualViewport.width,heightChanged:e,widthChanged:t})};visualViewport.addEventListener("resize",tr);const Ge=document.getElementById("playerHands"),ts=document.getElementById("playerHandsInner"),as=e=>e/1.3/4|0,rs=({height:e})=>{Ge.style.height=e+"px",ts.style.transform=`
    translateX(${as(e)}px) 
    translateY(12%)`},ar=()=>{Ge.classList.remove("hide")},os=()=>{Ge.classList.add("hide")};er.subscribe(rs);let $e=!1;const rr=async()=>{$e||($e=!0,m.play("swordAttack"),await ns(),$e=!1)},Ut=`
  rotateX(0deg) 
  rotateY(0deg) 
  rotateZ(0deg) 
  translateY(0px)
  translateX(0px)  
  skew(0deg, 0deg)
  scale(1)`,jt=`
  rotateX(0deg) 
  rotateY(0deg) 
  rotateZ(15deg) 
  translateY(-150px)
  translateX(0px)  
  skew(0deg, -0deg)
  scale(1)`,Nt=`
  rotateX(70deg)         
  rotateY(-50deg)         
  rotateZ(-20deg)         
  translateY(-3px)        
  translateX(0px)          
  skew(0deg, -30deg)        
  scale(1)`,et=(e,t,a)=>Ge.animate([{transform:e},{transform:t}],{duration:a}).finished,ns=async()=>{await et(Ut,jt,120),await et(jt,Nt,150),await et(Nt,Ut,230)},ss=()=>{window.addEventListener("click",rr)},is=()=>{window.removeEventListener("click",rr)},vt=document.querySelector("#room5 .swordItem1");let or=!1;const nr=()=>or,wt=({code:e})=>{e==="KeyE"&&(window.removeEventListener("keydown",wt),vt.remove(),ar(),m.play("pickingSword"),ss(),or=!0,ve("room5Sword"),L())},ls=()=>{vt.style.filter="brightness(1.5)",window.addEventListener("keydown",wt),H("press E")},As=()=>{vt.style.filter="brightness(1)",window.removeEventListener("keydown",wt),L()};R("room5Sword",{isActive:!1,maxX:450,minX:-50,maxZ:3350,minZ:3050,activationCallback:ls,deactivationCallback:As});const sr=()=>{m.loop("torch1",!0),m.play("torch1")},ir=()=>{m.loop("torch1",!1),m.stop("torch1")};R("room2Torch",{isActive:!1,maxX:450,minX:-150,maxZ:-200,minZ:-500,activationCallback:sr,deactivationCallback:ir});class ze extends Z{constructor({direction:a,keyCode:r,initMoveCallback:d,stopMoveCallback:l}){super();Y(this,"direction");Y(this,"isMoving");Y(this,"keyCode");Y(this,"initMoveCallback");Y(this,"stopMoveCallback");Y(this,"onKeyPress",({code:a})=>{a===this.keyCode&&(this.isMoving||(this.isMoving=!0,this.initMoveCallback(),this.broadcast({direction:this.direction,stateValue:this.isMoving})))});Y(this,"onKeyUp",({code:a})=>{a===this.keyCode&&(this.isMoving=!1,this.stopMoveCallback(),this.broadcast({direction:this.direction,stateValue:this.isMoving}))});this.direction=a,this.isMoving=!1,this.keyCode=r,this.initMoveCallback=d,this.stopMoveCallback=l}enable(){window.addEventListener("keydown",this.onKeyPress),window.addEventListener("keyup",this.onKeyUp)}stop(){this.isMoving=!1,this.stopMoveCallback()}disable(){window.removeEventListener("keydown",this.onKeyPress),window.removeEventListener("keyup",this.onKeyUp)}}const Te=new ze({direction:"forward",keyCode:"KeyW",initMoveCallback:()=>{re.startMove("forward")},stopMoveCallback:()=>{re.stopMove()}}),Pe=new ze({direction:"backward",keyCode:"KeyS",initMoveCallback:()=>{re.startMove("backward")},stopMoveCallback:()=>{re.stopMove()}}),Le=new ze({direction:"right",keyCode:"KeyD",initMoveCallback:()=>{oe.startMove("right")},stopMoveCallback:()=>{oe.stopMove()}}),Xe=new ze({direction:"left",keyCode:"KeyA",initMoveCallback:()=>{oe.startMove("left")},stopMoveCallback:()=>{oe.stopMove()}}),At={forward:!1,backward:!1,right:!1,left:!1};let lr=!1;const ds=()=>{lr=Object.values(At).includes(!0)},we=new Z,De=({direction:e,stateValue:t})=>{At[e]=t,ds(),we.broadcast({...At,changed:e,isMoving:lr})};Te.subscribe(De);Pe.subscribe(De);Le.subscribe(De);Xe.subscribe(De);let tt=!1;const Ue=()=>{const e=mn();let t;for(let[a,r]of e)if(t=cs(r),t){if(r.isActive)continue;r.isActive=!0,r.activationCallback()}else r.isActive&&(r.isActive=!1,r.deactivationCallback())},cs=e=>{const t=Ba(),a=Sa();return t>=e.minX&&t<=e.maxX&&a>=e.minZ&&a<=e.maxZ};let kt;const Ar=()=>{kt=requestAnimationFrame(Ar),Ue()},ps=()=>{kt=requestAnimationFrame(Ar)},dr=()=>{cancelAnimationFrame(kt)},cr=({isMoving:e})=>{if(e){if(tt)return;ps(),tt=!0}else dr(),tt=!1},pr=()=>{we.subscribe(cr)},gs=()=>{we.unsubscribe(cr)},gr=document.getElementById("openedScrollWrap"),us=document.getElementById("openedScroll"),ms=document.getElementById("scrollContentWrap"),hs=({code:e})=>{e==="KeyQ"&&fs()},ur=()=>us,mr=e=>{ms.innerHTML=e},hr=()=>{m.play("scrollRead"),gr.classList.add("open"),window.addEventListener("keydown",hs)},fs=()=>{m.play("scrollClose"),gr.classList.remove("open")},fr=document.querySelector("#room2 .scroll1"),xr=({code:e})=>{e==="KeyQ"&&(L(),window.removeEventListener("keydown",xr),Ue())},Bt=({code:e})=>{if(e!=="KeyE")return;Ea("room2Scroll");const t=ur();t.style.filter="brightness(0.8) hue-rotate(140deg)",mr("somewhere in this tunnels must be a secret portal..."),hr(),L(),H("press Q"),window.addEventListener("keydown",xr),window.removeEventListener("keydown",Bt)},xs=()=>{fr.classList.add("active"),window.addEventListener("keydown",Bt),H("press E")},qs=()=>{fr.classList.remove("active"),window.removeEventListener("keydown",Bt),L()};R("room2Scroll",{isActive:!1,maxZ:800,minZ:200,maxX:-100,minX:-500,activationCallback:xs,deactivationCallback:qs});const St=()=>{m.loop("bugSound1",!0),m.play("bugSound1")},Mt=()=>{m.loop("bugSound1",!1),m.stop("bugSound1")};R("room2WallBug",{isActive:!1,maxX:950,minX:600,maxZ:250,minZ:-100,activationCallback:St,deactivationCallback:Mt});const qr=document.querySelector("#room3 .scroll1"),br=({code:e})=>{e==="KeyQ"&&(L(),window.removeEventListener("keydown",br),Ue())},Et=({code:e})=>{if(e!=="KeyE")return;const t=ur();t.style.filter="brightness(0.8) hue-rotate(260deg)",Ea("room3Scroll"),mr("further danger awaits you, better find some weapon and heal your wounds"),hr(),L(),H("press Q"),window.addEventListener("keydown",br),window.removeEventListener("keydown",Et)},bs=()=>{qr.classList.add("active"),window.addEventListener("keydown",Et),H("press E")},ys=()=>{qr.classList.remove("active"),window.removeEventListener("keydown",Et),L()};R("room3Scroll",{isActive:!1,maxZ:2e3,minZ:1400,maxX:1600,minX:1100,activationCallback:bs,deactivationCallback:ys});const yr=document.getElementById("manaBar"),vs=3,ws=500;let V=0,vr=null;const ks=e=>{V=e,Ct()},wr=()=>{yr.animate([{opacity:.5},{opacity:1},{opacity:.5}],{duration:500})},kr=()=>V,Br=e=>{e<=V?V-=e:V=0,Ct()},Bs=e=>{V+=e,V>100&&(V=100),Ct()},Ct=()=>{yr.style.setProperty("--manaValue",`${V}%`)},Ss=()=>{vr=setInterval(Bs,ws,vs)},Ms=()=>{clearInterval(vr)},Wt=document.getElementById("pointerLockInaccessibleIcon");let dt=!1;const Es=async()=>{dt||(Ws(),await Cs(),Ys())},Cs=()=>{dt=!0;const e=Wt.animate([{transform:"scale(1)"},{transform:"scale(0.7)"},{transform:"scale(1)"}],{duration:1e3});return e.finished.then(()=>{dt=!1}),e.finished},Ws=()=>{Wt.classList.remove("hide")},Ys=()=>{Wt.classList.add("hide")},Re=new Z,Is=document.body.requestPointerLock.bind(document.body),Sr=()=>{document.pointerLockElement===document.body?Re.broadcast(!0):Re.broadcast(!1)},Yt=()=>{Is().catch(Es)},Mr=()=>{document.exitPointerLock()},Ts=()=>{document.addEventListener("pointerlockchange",Sr),document.addEventListener("click",Yt)},Ps=()=>{document.removeEventListener("pointerlockchange",Sr),document.removeEventListener("click",Yt)},Er=({code:e})=>{if(e==="ShiftLeft"){if(Ua())return;Fn()}},Cr=({code:e})=>{!Ua()||e==="ShiftLeft"&&ja()},Ls=()=>{window.addEventListener("keydown",Er),window.addEventListener("keyup",Cr)},Xs=()=>{window.removeEventListener("keydown",Er),window.removeEventListener("keyup",Cr)};let Rs=0,Wr=0,Os=0;const Zs=()=>Rs,It=()=>Wr,Qs=()=>Os,Yr=e=>{Wr=e},Ir=150;let Tt=!1;const Tr=()=>Tt,Fs=()=>{Tt=!0,Yr(It()-Ir),Gn(),Ga("squat"),za()},Gs=()=>{Tt=!1,Yr(It()+Ir),zn(),Da()},Pr=({code:e})=>{if(e==="KeyC"){if(Tr())return;Fs()}},Lr=({code:e})=>{!Tr()||e==="KeyC"&&Gs()},Xr=()=>{window.addEventListener("keydown",Pr),window.addEventListener("keyup",Lr)},Rr=()=>{window.removeEventListener("keydown",Pr),window.removeEventListener("keyup",Lr)},Pt=e=>{e?(Te.enable(),Pe.enable(),Xe.enable(),Le.enable(),Ls(),Xr(),sn()):(Te.disable(),Pe.disable(),Xe.disable(),Le.disable(),Xs(),Rr(),ln())},zs=()=>{Re.subscribe(Pt)};var _=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},Lt={},J={},pe={exports:{}};(function(e,t){/** @preserve SAT.js - Version 0.9.0 - Copyright 2012 - 2021 - Jim Riecken <jimr@jimr.ca> - released under the MIT License. https://github.com/jriecken/sat-js */(function(a,r){e.exports=r()})(_,function(){var a={};function r(o,A){this.x=o||0,this.y=A||0}a.Vector=r,a.V=r,r.prototype.copy=r.prototype.copy=function(o){return this.x=o.x,this.y=o.y,this},r.prototype.clone=r.prototype.clone=function(){return new r(this.x,this.y)},r.prototype.perp=r.prototype.perp=function(){var o=this.x;return this.x=this.y,this.y=-o,this},r.prototype.rotate=r.prototype.rotate=function(o){var A=this.x,s=this.y;return this.x=A*Math.cos(o)-s*Math.sin(o),this.y=A*Math.sin(o)+s*Math.cos(o),this},r.prototype.reverse=r.prototype.reverse=function(){return this.x=-this.x,this.y=-this.y,this},r.prototype.normalize=r.prototype.normalize=function(){var o=this.len();return o>0&&(this.x=this.x/o,this.y=this.y/o),this},r.prototype.add=r.prototype.add=function(o){return this.x+=o.x,this.y+=o.y,this},r.prototype.sub=r.prototype.sub=function(o){return this.x-=o.x,this.y-=o.y,this},r.prototype.scale=r.prototype.scale=function(o,A){return this.x*=o,this.y*=typeof A!="undefined"?A:o,this},r.prototype.project=r.prototype.project=function(o){var A=this.dot(o)/o.len2();return this.x=A*o.x,this.y=A*o.y,this},r.prototype.projectN=r.prototype.projectN=function(o){var A=this.dot(o);return this.x=A*o.x,this.y=A*o.y,this},r.prototype.reflect=r.prototype.reflect=function(o){var A=this.x,s=this.y;return this.project(o).scale(2),this.x-=A,this.y-=s,this},r.prototype.reflectN=r.prototype.reflectN=function(o){var A=this.x,s=this.y;return this.projectN(o).scale(2),this.x-=A,this.y-=s,this},r.prototype.dot=r.prototype.dot=function(o){return this.x*o.x+this.y*o.y},r.prototype.len2=r.prototype.len2=function(){return this.dot(this)},r.prototype.len=r.prototype.len=function(){return Math.sqrt(this.len2())};function d(o,A){this.pos=o||new r,this.r=A||0,this.offset=new r}a.Circle=d,d.prototype.getAABBAsBox=d.prototype.getAABBAsBox=function(){var o=this.r,A=this.pos.clone().add(this.offset).sub(new r(o,o));return new q(A,o*2,o*2)},d.prototype.getAABB=d.prototype.getAABB=function(){return this.getAABBAsBox().toPolygon()},d.prototype.setOffset=d.prototype.setOffset=function(o){return this.offset=o,this};function l(o,A){this.pos=o||new r,this.angle=0,this.offset=new r,this.setPoints(A||[])}a.Polygon=l,l.prototype.setPoints=l.prototype.setPoints=function(o){var A=!this.points||this.points.length!==o.length;if(A){var s,u=this.calcPoints=[],g=this.edges=[],y=this.normals=[];for(s=0;s<o.length;s++){var w=o[s],p=s<o.length-1?o[s+1]:o[0];if(w!==p&&w.x===p.x&&w.y===p.y){o.splice(s,1),s-=1;continue}u.push(new r),g.push(new r),y.push(new r)}}return this.points=o,this._recalc(),this},l.prototype.setAngle=l.prototype.setAngle=function(o){return this.angle=o,this._recalc(),this},l.prototype.setOffset=l.prototype.setOffset=function(o){return this.offset=o,this._recalc(),this},l.prototype.rotate=l.prototype.rotate=function(o){for(var A=this.points,s=A.length,u=0;u<s;u++)A[u].rotate(o);return this._recalc(),this},l.prototype.translate=l.prototype.translate=function(o,A){for(var s=this.points,u=s.length,g=0;g<u;g++)s[g].x+=o,s[g].y+=A;return this._recalc(),this},l.prototype._recalc=function(){var o=this.calcPoints,A=this.edges,s=this.normals,u=this.points,g=this.offset,y=this.angle,w=u.length,p;for(p=0;p<w;p++){var B=o[p].copy(u[p]);B.x+=g.x,B.y+=g.y,y!==0&&B.rotate(y)}for(p=0;p<w;p++){var M=o[p],W=p<w-1?o[p+1]:o[0],X=A[p].copy(W).sub(M);s[p].copy(X).perp().normalize()}return this},l.prototype.getAABBAsBox=l.prototype.getAABBAsBox=function(){for(var o=this.calcPoints,A=o.length,s=o[0].x,u=o[0].y,g=o[0].x,y=o[0].y,w=1;w<A;w++){var p=o[w];p.x<s?s=p.x:p.x>g&&(g=p.x),p.y<u?u=p.y:p.y>y&&(y=p.y)}return new q(this.pos.clone().add(new r(s,u)),g-s,y-u)},l.prototype.getAABB=l.prototype.getAABB=function(){return this.getAABBAsBox().toPolygon()},l.prototype.getCentroid=l.prototype.getCentroid=function(){for(var o=this.calcPoints,A=o.length,s=0,u=0,g=0,y=0;y<A;y++){var w=o[y],p=y===A-1?o[0]:o[y+1],B=w.x*p.y-p.x*w.y;s+=(w.x+p.x)*B,u+=(w.y+p.y)*B,g+=B}return g=g*3,s=s/g,u=u/g,new r(s,u)};function q(o,A,s){this.pos=o||new r,this.w=A||0,this.h=s||0}a.Box=q,q.prototype.toPolygon=q.prototype.toPolygon=function(){var o=this.pos,A=this.w,s=this.h;return new l(new r(o.x,o.y),[new r,new r(A,0),new r(A,s),new r(0,s)])};function k(){this.a=null,this.b=null,this.overlapN=new r,this.overlapV=new r,this.clear()}a.Response=k,k.prototype.clear=k.prototype.clear=function(){return this.aInB=!0,this.bInA=!0,this.overlap=Number.MAX_VALUE,this};for(var b=[],E=0;E<10;E++)b.push(new r);for(var T=[],E=0;E<5;E++)T.push([]);var Q=new k,D=new q(new r,1e-6,1e-6).toPolygon();function F(o,A,s){for(var u=Number.MAX_VALUE,g=-Number.MAX_VALUE,y=o.length,w=0;w<y;w++){var p=o[w].dot(A);p<u&&(u=p),p>g&&(g=p)}s[0]=u,s[1]=g}function G(o,A,s,u,g,y){var w=T.pop(),p=T.pop(),B=b.pop().copy(A).sub(o),M=B.dot(g);if(F(s,g,w),F(u,g,p),p[0]+=M,p[1]+=M,w[0]>p[1]||p[0]>w[1])return b.push(B),T.push(w),T.push(p),!0;if(y){var W=0;if(w[0]<p[0])if(y.aInB=!1,w[1]<p[1])W=w[1]-p[0],y.bInA=!1;else{var X=w[1]-p[0],O=p[1]-w[0];W=X<O?X:-O}else if(y.bInA=!1,w[1]>p[1])W=w[0]-p[1],y.aInB=!1;else{var X=w[1]-p[0],O=p[1]-w[0];W=X<O?X:-O}var C=Math.abs(W);C<y.overlap&&(y.overlap=C,y.overlapN.copy(g),W<0&&y.overlapN.reverse())}return b.push(B),T.push(w),T.push(p),!1}a.isSeparatingAxis=G;function z(o,A){var s=o.len2(),u=A.dot(o);return u<0?U:u>s?n:Me}var U=-1,Me=0,n=1;function i(o,A){var s=b.pop().copy(o).sub(A.pos).sub(A.offset),u=A.r*A.r,g=s.len2();return b.push(s),g<=u}a.pointInCircle=i;function c(o,A){D.pos.copy(o),Q.clear();var s=v(D,A,Q);return s&&(s=Q.aInB),s}a.pointInPolygon=c;function x(o,A,s){var u=b.pop().copy(A.pos).add(A.offset).sub(o.pos).sub(o.offset),g=o.r+A.r,y=g*g,w=u.len2();if(w>y)return b.push(u),!1;if(s){var p=Math.sqrt(w);s.a=o,s.b=A,s.overlap=g-p,s.overlapN.copy(u.normalize()),s.overlapV.copy(u).scale(s.overlap),s.aInB=o.r<=A.r&&p<=A.r-o.r,s.bInA=A.r<=o.r&&p<=o.r-A.r}return b.push(u),!0}a.testCircleCircle=x;function h(o,A,s){for(var u=b.pop().copy(A.pos).add(A.offset).sub(o.pos),g=A.r,y=g*g,w=o.calcPoints,p=w.length,B=b.pop(),M=b.pop(),W=0;W<p;W++){var X=W===p-1?0:W+1,O=W===0?p-1:W-1,C=0,me=null;B.copy(o.edges[W]),M.copy(u).sub(w[W]),s&&M.len2()>y&&(s.aInB=!1);var ie=z(B,M);if(ie===U){B.copy(o.edges[O]);var Je=b.pop().copy(u).sub(w[O]);if(ie=z(B,Je),ie===n){var j=M.len();if(j>g)return b.push(u),b.push(B),b.push(M),b.push(Je),!1;s&&(s.bInA=!1,me=M.normalize(),C=g-j)}b.push(Je)}else if(ie===n){if(B.copy(o.edges[X]),M.copy(u).sub(w[X]),ie=z(B,M),ie===U){var j=M.len();if(j>g)return b.push(u),b.push(B),b.push(M),!1;s&&(s.bInA=!1,me=M.normalize(),C=g-j)}}else{var Ke=B.perp().normalize(),j=M.dot(Ke),uo=Math.abs(j);if(j>0&&uo>g)return b.push(u),b.push(Ke),b.push(M),!1;s&&(me=Ke,C=g-j,(j>=0||C<2*g)&&(s.bInA=!1))}me&&s&&Math.abs(C)<Math.abs(s.overlap)&&(s.overlap=C,s.overlapN.copy(me))}return s&&(s.a=o,s.b=A,s.overlapV.copy(s.overlapN).scale(s.overlap)),b.push(u),b.push(B),b.push(M),!0}a.testPolygonCircle=h;function f(o,A,s){var u=h(A,o,s);if(u&&s){var g=s.a,y=s.aInB;s.overlapN.reverse(),s.overlapV.reverse(),s.a=s.b,s.b=g,s.aInB=s.bInA,s.bInA=y}return u}a.testCirclePolygon=f;function v(o,A,s){for(var u=o.calcPoints,g=u.length,y=A.calcPoints,w=y.length,p=0;p<g;p++)if(G(o.pos,A.pos,u,y,o.normals[p],s))return!1;for(var p=0;p<w;p++)if(G(o.pos,A.pos,u,y,A.normals[p],s))return!1;return s&&(s.a=o,s.b=A,s.overlapV.copy(s.overlapN).scale(s.overlap)),!0}return a.testPolygonPolygon=v,a})})(pe);(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Types=e.Response=void 0;var t=pe.exports;Object.defineProperty(e,"Response",{enumerable:!0,get:function(){return t.Response}}),function(a){a.Ellipse="Ellipse",a.Line="Line",a.Circle="Circle",a.Box="Box",a.Point="Point",a.Polygon="Polygon"}(e.Types||(e.Types={}))})(J);var ke={},S={},ge={},$={};Object.defineProperty($,"__esModule",{value:!0});$.Polygon=void 0;const Ds=pe.exports,Us=J,at=S;class js extends Ds.Polygon{constructor(t,a){if(super((0,at.ensureVectorPoint)(t),(0,at.ensurePolygonPoints)(a)),this.type=Us.Types.Polygon,!(a!=null&&a.length))throw new Error("No points in polygon");this.updateAABB()}get x(){return this.pos.x}set x(t){var a;this.pos.x=t,(a=this.system)===null||a===void 0||a.updateBody(this)}get y(){return this.pos.y}set y(t){var a;this.pos.y=t,(a=this.system)===null||a===void 0||a.updateBody(this)}setPosition(t,a){var r;this.pos.x=t,this.pos.y=a,(r=this.system)===null||r===void 0||r.updateBody(this)}updateAABB(){const{pos:t,w:a,h:r}=this.getAABBAsBox();this.minX=t.x,this.minY=t.y,this.maxX=t.x+a,this.maxY=t.y+r}draw(t){[...this.calcPoints,this.calcPoints[0]].forEach((r,d)=>{const l=this.pos.x+r.x,q=this.pos.y+r.y,k=this.calcPoints[d-1]||this.calcPoints[this.calcPoints.length-1];if(!d)this.calcPoints.length===1?t.arc(l,q,1,0,Math.PI*2):t.moveTo(l,q);else if(this.calcPoints.length>1)if(this.isTrigger){const b=this.pos.x+k.x,E=this.pos.y+k.y;(0,at.dashLineTo)(t,b,E,l,q)}else t.lineTo(l,q)})}}$.Polygon=js;Object.defineProperty(ge,"__esModule",{value:!0});ge.Line=void 0;const Ns=J,Vs=$;class Hs extends Vs.Polygon{constructor(t,a){if(super({x:(t.x+a.x)/2,y:(t.y+a.y)/2},[{x:-(a.x-t.x)/2,y:-(a.y-t.y)/2},{x:(a.x-t.x)/2,y:(a.y-t.y)/2}]),this.type=Ns.Types.Line,this.calcPoints.length===1||!a)throw console.error({start:t,end:a}),new Error("No end point for line provided")}get start(){return{x:this.x+this.calcPoints[0].x,y:this.y+this.calcPoints[0].y}}get end(){return{x:this.x+this.calcPoints[1].x,y:this.y+this.calcPoints[1].y}}}ge.Line=Hs;Object.defineProperty(S,"__esModule",{value:!0});S.intersectLinePolygon=S.intersectLineLine=S.intersectLineCircle=S.dashLineTo=S.clockwise=S.distance=S.ensurePolygonPoints=S.ensureVectorPoint=S.createBox=S.createEllipse=void 0;const ee=pe.exports,Js=ge;function Ks(e,t=e,a=1){const r=Math.PI*Math.hypot(e,t)*2,d=Math.max(8,Math.ceil(r/a));return Array.from({length:d},(l,q)=>{const k=q/d*2*Math.PI,b=Math.cos(k)*e,E=Math.sin(k)*t;return new ee.Vector(b,E)})}S.createEllipse=Ks;function _s(e,t){return[new ee.Vector(0,0),new ee.Vector(e,0),new ee.Vector(e,t),new ee.Vector(0,t)]}S.createBox=_s;function Or(e={}){return e instanceof ee.Vector?e:new ee.Vector(e.x||0,e.y||0)}S.ensureVectorPoint=Or;function $s(e){if(!e)throw new Error("No points array provided");const t=e.map(Or);return Zr(t)?t.reverse():t}S.ensurePolygonPoints=$s;function ei(e,t){return Math.hypot(e.x-t.x,e.y-t.y)}S.distance=ei;function Zr(e){let t=0;for(let a=0;a<e.length;a++){const r=e[a],d=e[(a+1)%e.length];t+=(d.x-r.x)*(d.y+r.y)}return t>0}S.clockwise=Zr;function ti(e,t,a,r,d,l=2,q=4){const k=r-t,b=d-a,E=Math.atan2(b,k),T=Math.cos(E),Q=Math.sin(E);let D=t,F=a,G=Math.hypot(k,b);for(;G>0;){const z=Math.min(G,l);e.moveTo(D,F),e.lineTo(D+T*z,F+Q*z),D+=T*(l+q),F+=Q*(l+q),G-=l+q}}S.dashLineTo=ti;function ai(e,t){const a={x:e.end.x-e.start.x,y:e.end.y-e.start.y},r={x:e.start.x-t.pos.x,y:e.start.y-t.pos.y},d=(a.x*r.x+a.y*r.y)*-2,l=(a.x*a.x+a.y*a.y)*2,q=Math.sqrt(d*d-(r.x*r.x+r.y*r.y-t.r*t.r)*l*2);if(isNaN(q))return[];const k=(d-q)/l,b=(d+q)/l,E=[];return k<=1&&k>=0&&E.push({x:e.start.x+a.x*k,y:e.start.y+a.y*k}),b<=1&&b>=0&&E.push({x:e.start.x+a.x*b,y:e.start.y+a.y*b}),E}S.intersectLineCircle=ai;function Qr(e,t){const a=e.end.x-e.start.x,r=e.end.y-e.start.y,d=a*(t.end.y-t.start.y)-(t.end.x-t.start.x)*r;if(d===0)return null;const l=((t.end.y-t.start.y)*(t.end.x-e.start.x)+(t.start.x-t.end.x)*(t.end.y-e.start.y))/d,q=((e.start.y-e.end.y)*(t.end.x-e.start.x)+a*(t.end.y-e.start.y))/d;return!(l>=0&&l<=1)||!(q>=0&&q<=1)?null:{x:e.start.x+l*a,y:e.start.y+l*r}}S.intersectLineLine=Qr;function ri(e,t){return t.calcPoints.map((a,r)=>{const d=r?t.calcPoints[r-1]:t.calcPoints[t.calcPoints.length-1],l=new Js.Line({x:d.x+t.pos.x,y:d.y+t.pos.y},{x:a.x+t.pos.x,y:a.y+t.pos.y});return Qr(e,l)}).filter(a=>!!a)}S.intersectLinePolygon=ri;Object.defineProperty(ke,"__esModule",{value:!0});ke.Circle=void 0;const oi=pe.exports,ni=J,Vt=S;class si extends oi.Circle{constructor(t,a){super((0,Vt.ensureVectorPoint)(t),a),this.type=ni.Types.Circle,this.updateAABB()}get x(){return this.pos.x}set x(t){var a;this.pos.x=t,(a=this.system)===null||a===void 0||a.updateBody(this)}get y(){return this.pos.y}set y(t){var a;this.pos.y=t,(a=this.system)===null||a===void 0||a.updateBody(this)}setPosition(t,a){var r;this.pos.x=t,this.pos.y=a,(r=this.system)===null||r===void 0||r.updateBody(this)}updateAABB(){this.minX=this.pos.x-this.r,this.minY=this.pos.y-this.r,this.maxX=this.pos.x+this.r,this.maxY=this.pos.y+this.r}draw(t){const a=this.r;if(this.isTrigger){const r=Math.max(8,a);for(let d=0;d<r;d++){const l=d/r*2*Math.PI,q=(d-1)/r*2*Math.PI,k=this.pos.x+Math.cos(q)*a,b=this.pos.y+Math.sin(q)*a,E=this.pos.x+Math.cos(l)*a,T=this.pos.y+Math.sin(l)*a;(0,Vt.dashLineTo)(t,k,b,E,T)}}else t.moveTo(this.pos.x+a,this.pos.y),t.arc(this.pos.x,this.pos.y,a,0,Math.PI*2)}}ke.Circle=si;var Be={};Object.defineProperty(Be,"__esModule",{value:!0});Be.Ellipse=void 0;const ii=J,Ee=S,li=$;class Ai extends li.Polygon{constructor(t,a,r=a,d=Math.hypot(a,r)/Math.PI){super(t,(0,Ee.createEllipse)(a,r,d)),this.type=ii.Types.Ellipse,this._radiusX=a,this._radiusY=r,this._step=d}get step(){return this._step}set step(t){this._step=t,this.setPoints((0,Ee.createEllipse)(this._radiusX,this._radiusY,this._step))}get radiusX(){return this._radiusX}set radiusX(t){this._radiusX=t,this.setPoints((0,Ee.createEllipse)(this._radiusX,this._radiusY,this._step))}get radiusY(){return this._radiusY}set radiusY(t){this._radiusY=t,this.setPoints((0,Ee.createEllipse)(this._radiusX,this._radiusY,this._step))}}Be.Ellipse=Ai;var ue={};Object.defineProperty(ue,"__esModule",{value:!0});ue.Box=void 0;const di=J,rt=S,ci=$;class pi extends ci.Polygon{constructor(t,a,r){super(t,(0,rt.createBox)(a,r)),this.type=di.Types.Box,this._width=a,this._height=r}get width(){return this._width}set width(t){this._width=t,this.setPoints((0,rt.createBox)(this._width,this._height))}get height(){return this._height}set height(t){this._height=t,this.setPoints((0,rt.createBox)(this._width,this._height))}getCentroidWithoutRotation(){const t=this.angle;this.setAngle(0);const a=this.getCentroid();return this.setAngle(t),a}center(){const t=this.points[0];if(t.x!==0||t.y!==0)return;const{x:a,y:r}=this.getCentroidWithoutRotation();this.translate(-a,-r),this.setPosition(this.pos.x+a,this.pos.y+r)}}ue.Box=pi;var Se={};Object.defineProperty(Se,"__esModule",{value:!0});Se.Point=void 0;const gi=ue,ui=J,mi=S;class hi extends gi.Box{constructor(t){super((0,mi.ensureVectorPoint)(t),.1,.1),this.type=ui.Types.Point}}Se.Point=hi;var je={},Fr={exports:{}};(function(e,t){(function(a,r){e.exports=r()})(_,function(){function a(n,i,c,x,h){(function f(v,o,A,s,u){for(;s>A;){if(s-A>600){var g=s-A+1,y=o-A+1,w=Math.log(g),p=.5*Math.exp(2*w/3),B=.5*Math.sqrt(w*p*(g-p)/g)*(y-g/2<0?-1:1),M=Math.max(A,Math.floor(o-y*p/g+B)),W=Math.min(s,Math.floor(o+(g-y)*p/g+B));f(v,o,M,W,u)}var X=v[o],O=A,C=s;for(r(v,A,o),u(v[s],X)>0&&r(v,A,s);O<C;){for(r(v,O,C),O++,C--;u(v[O],X)<0;)O++;for(;u(v[C],X)>0;)C--}u(v[A],X)===0?r(v,A,C):r(v,++C,s),C<=o&&(A=C+1),o<=C&&(s=C-1)}})(n,i,c||0,x||n.length-1,h||d)}function r(n,i,c){var x=n[i];n[i]=n[c],n[c]=x}function d(n,i){return n<i?-1:n>i?1:0}var l=function(n){n===void 0&&(n=9),this._maxEntries=Math.max(4,n),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function q(n,i,c){if(!c)return i.indexOf(n);for(var x=0;x<i.length;x++)if(c(n,i[x]))return x;return-1}function k(n,i){b(n,0,n.children.length,i,n)}function b(n,i,c,x,h){h||(h=U(null)),h.minX=1/0,h.minY=1/0,h.maxX=-1/0,h.maxY=-1/0;for(var f=i;f<c;f++){var v=n.children[f];E(h,n.leaf?x(v):v)}return h}function E(n,i){return n.minX=Math.min(n.minX,i.minX),n.minY=Math.min(n.minY,i.minY),n.maxX=Math.max(n.maxX,i.maxX),n.maxY=Math.max(n.maxY,i.maxY),n}function T(n,i){return n.minX-i.minX}function Q(n,i){return n.minY-i.minY}function D(n){return(n.maxX-n.minX)*(n.maxY-n.minY)}function F(n){return n.maxX-n.minX+(n.maxY-n.minY)}function G(n,i){return n.minX<=i.minX&&n.minY<=i.minY&&i.maxX<=n.maxX&&i.maxY<=n.maxY}function z(n,i){return i.minX<=n.maxX&&i.minY<=n.maxY&&i.maxX>=n.minX&&i.maxY>=n.minY}function U(n){return{children:n,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Me(n,i,c,x,h){for(var f=[i,c];f.length;)if(!((c=f.pop())-(i=f.pop())<=x)){var v=i+Math.ceil((c-i)/x/2)*x;a(n,v,i,c,h),f.push(i,v,v,c)}}return l.prototype.all=function(){return this._all(this.data,[])},l.prototype.search=function(n){var i=this.data,c=[];if(!z(n,i))return c;for(var x=this.toBBox,h=[];i;){for(var f=0;f<i.children.length;f++){var v=i.children[f],o=i.leaf?x(v):v;z(n,o)&&(i.leaf?c.push(v):G(n,o)?this._all(v,c):h.push(v))}i=h.pop()}return c},l.prototype.collides=function(n){var i=this.data;if(!z(n,i))return!1;for(var c=[];i;){for(var x=0;x<i.children.length;x++){var h=i.children[x],f=i.leaf?this.toBBox(h):h;if(z(n,f)){if(i.leaf||G(n,f))return!0;c.push(h)}}i=c.pop()}return!1},l.prototype.load=function(n){if(!n||!n.length)return this;if(n.length<this._minEntries){for(var i=0;i<n.length;i++)this.insert(n[i]);return this}var c=this._build(n.slice(),0,n.length-1,0);if(this.data.children.length)if(this.data.height===c.height)this._splitRoot(this.data,c);else{if(this.data.height<c.height){var x=this.data;this.data=c,c=x}this._insert(c,this.data.height-c.height-1,!0)}else this.data=c;return this},l.prototype.insert=function(n){return n&&this._insert(n,this.data.height-1),this},l.prototype.clear=function(){return this.data=U([]),this},l.prototype.remove=function(n,i){if(!n)return this;for(var c,x,h,f=this.data,v=this.toBBox(n),o=[],A=[];f||o.length;){if(f||(f=o.pop(),x=o[o.length-1],c=A.pop(),h=!0),f.leaf){var s=q(n,f.children,i);if(s!==-1)return f.children.splice(s,1),o.push(f),this._condense(o),this}h||f.leaf||!G(f,v)?x?(c++,f=x.children[c],h=!1):f=null:(o.push(f),A.push(c),c=0,x=f,f=f.children[0])}return this},l.prototype.toBBox=function(n){return n},l.prototype.compareMinX=function(n,i){return n.minX-i.minX},l.prototype.compareMinY=function(n,i){return n.minY-i.minY},l.prototype.toJSON=function(){return this.data},l.prototype.fromJSON=function(n){return this.data=n,this},l.prototype._all=function(n,i){for(var c=[];n;)n.leaf?i.push.apply(i,n.children):c.push.apply(c,n.children),n=c.pop();return i},l.prototype._build=function(n,i,c,x){var h,f=c-i+1,v=this._maxEntries;if(f<=v)return k(h=U(n.slice(i,c+1)),this.toBBox),h;x||(x=Math.ceil(Math.log(f)/Math.log(v)),v=Math.ceil(f/Math.pow(v,x-1))),(h=U([])).leaf=!1,h.height=x;var o=Math.ceil(f/v),A=o*Math.ceil(Math.sqrt(v));Me(n,i,c,A,this.compareMinX);for(var s=i;s<=c;s+=A){var u=Math.min(s+A-1,c);Me(n,s,u,o,this.compareMinY);for(var g=s;g<=u;g+=o){var y=Math.min(g+o-1,u);h.children.push(this._build(n,g,y,x-1))}}return k(h,this.toBBox),h},l.prototype._chooseSubtree=function(n,i,c,x){for(;x.push(i),!i.leaf&&x.length-1!==c;){for(var h=1/0,f=1/0,v=void 0,o=0;o<i.children.length;o++){var A=i.children[o],s=D(A),u=(g=n,y=A,(Math.max(y.maxX,g.maxX)-Math.min(y.minX,g.minX))*(Math.max(y.maxY,g.maxY)-Math.min(y.minY,g.minY))-s);u<f?(f=u,h=s<h?s:h,v=A):u===f&&s<h&&(h=s,v=A)}i=v||i.children[0]}var g,y;return i},l.prototype._insert=function(n,i,c){var x=c?n:this.toBBox(n),h=[],f=this._chooseSubtree(x,this.data,i,h);for(f.children.push(n),E(f,x);i>=0&&h[i].children.length>this._maxEntries;)this._split(h,i),i--;this._adjustParentBBoxes(x,h,i)},l.prototype._split=function(n,i){var c=n[i],x=c.children.length,h=this._minEntries;this._chooseSplitAxis(c,h,x);var f=this._chooseSplitIndex(c,h,x),v=U(c.children.splice(f,c.children.length-f));v.height=c.height,v.leaf=c.leaf,k(c,this.toBBox),k(v,this.toBBox),i?n[i-1].children.push(v):this._splitRoot(c,v)},l.prototype._splitRoot=function(n,i){this.data=U([n,i]),this.data.height=n.height+1,this.data.leaf=!1,k(this.data,this.toBBox)},l.prototype._chooseSplitIndex=function(n,i,c){for(var x,h,f,v,o,A,s,u=1/0,g=1/0,y=i;y<=c-i;y++){var w=b(n,0,y,this.toBBox),p=b(n,y,c,this.toBBox),B=(h=w,f=p,v=void 0,o=void 0,A=void 0,s=void 0,v=Math.max(h.minX,f.minX),o=Math.max(h.minY,f.minY),A=Math.min(h.maxX,f.maxX),s=Math.min(h.maxY,f.maxY),Math.max(0,A-v)*Math.max(0,s-o)),M=D(w)+D(p);B<u?(u=B,x=y,g=M<g?M:g):B===u&&M<g&&(g=M,x=y)}return x||c-i},l.prototype._chooseSplitAxis=function(n,i,c){var x=n.leaf?this.compareMinX:T,h=n.leaf?this.compareMinY:Q;this._allDistMargin(n,i,c,x)<this._allDistMargin(n,i,c,h)&&n.children.sort(x)},l.prototype._allDistMargin=function(n,i,c,x){n.children.sort(x);for(var h=this.toBBox,f=b(n,0,i,h),v=b(n,c-i,c,h),o=F(f)+F(v),A=i;A<c-i;A++){var s=n.children[A];E(f,n.leaf?h(s):s),o+=F(f)}for(var u=c-i-1;u>=i;u--){var g=n.children[u];E(v,n.leaf?h(g):g),o+=F(v)}return o},l.prototype._adjustParentBBoxes=function(n,i,c){for(var x=c;x>=0;x--)E(i[x],n)},l.prototype._condense=function(n){for(var i=n.length-1,c=void 0;i>=0;i--)n[i].children.length===0?i>0?(c=n[i-1].children).splice(c.indexOf(n[i]),1):this.clear():k(n[i],this.toBBox)},l})})(Fr);var fi=_&&_.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(je,"__esModule",{value:!0});je.System=void 0;const Ce=pe.exports,xi=fi(Fr.exports),N=J,he=S,qi=Se,bi=ke,yi=ue,ot=$,vi=ge,wi=Be;class ki extends xi.default{constructor(){super(...arguments),this.response=new N.Response}draw(t){this.all().forEach(a=>{a.draw(t)})}drawBVH(t){this.data.children.forEach(({minX:a,maxX:r,minY:d,maxY:l})=>{ot.Polygon.prototype.draw.call({pos:{x:a,y:d},calcPoints:(0,he.createBox)(r-a,l-d)},t)}),this.all().forEach(a=>{const{pos:r,w:d,h:l}=a.getAABBAsBox();ot.Polygon.prototype.draw.call({pos:r,calcPoints:(0,he.createBox)(d,l)},t)})}updateBody(t){this.remove(t),t.updateAABB(),this.insert(t)}remove(t,a){return t.system=void 0,super.remove(t,a)}insert(t){return t.system=this,super.insert(t)}update(){this.all().forEach(t=>{t.isStatic||this.updateBody(t)})}separate(){this.checkAll(t=>{t.a.isTrigger||(t.a.pos.x-=t.overlapV.x,t.a.pos.y-=t.overlapV.y,this.updateBody(t.a))})}checkOne(t,a){t.isStatic||this.getPotentials(t).forEach(r=>{this.checkCollision(t,r)&&a(this.response)})}checkAll(t){this.all().forEach(a=>{this.checkOne(a,t)})}getPotentials(t){return this.search(t).filter(a=>a!==t)}checkCollision(t,a){if(this.response.clear(),t.type===N.Types.Circle&&a.type===N.Types.Circle)return(0,Ce.testCircleCircle)(t,a,this.response);if(t.type===N.Types.Circle&&a.type!==N.Types.Circle)return(0,Ce.testCirclePolygon)(t,a,this.response);if(t.type!==N.Types.Circle&&a.type===N.Types.Circle)return(0,Ce.testPolygonCircle)(t,a,this.response);if(t.type!==N.Types.Circle&&a.type!==N.Types.Circle)return(0,Ce.testPolygonPolygon)(t,a,this.response);throw Error("Not implemented")}raycast(t,a,r=()=>!0){let d=1/0,l=null;const q=this.createLine(t,a),k=this.getPotentials(q).filter(b=>r(b)&&this.checkCollision(q,b));return this.remove(q),k.forEach(b=>{(b.type===N.Types.Circle?(0,he.intersectLineCircle)(q,b):(0,he.intersectLinePolygon)(q,b)).forEach(T=>{const Q=(0,he.distance)(t,T);Q<d&&(d=Q,l={point:T,collider:b})})}),l}createPoint(t){const a=new qi.Point(t);return this.insert(a),a}createLine(t,a,r=0){const d=new vi.Line(t,a);return d.setAngle(r),this.insert(d),d}createCircle(t,a){const r=new bi.Circle(t,a);return this.insert(r),r}createBox(t,a,r,d=0){const l=new yi.Box(t,a,r);return l.setAngle(d),this.insert(l),l}createEllipse(t,a,r,d,l=0){const q=new wi.Ellipse(t,a,r,d);return q.setAngle(l),this.insert(q),q}createPolygon(t,a,r=0){const d=new ot.Polygon(t,a);return d.setAngle(r),this.insert(d),d}}je.System=ki;(function(e){var t=_&&_.__createBinding||(Object.create?function(r,d,l,q){q===void 0&&(q=l);var k=Object.getOwnPropertyDescriptor(d,l);(!k||("get"in k?!d.__esModule:k.writable||k.configurable))&&(k={enumerable:!0,get:function(){return d[l]}}),Object.defineProperty(r,q,k)}:function(r,d,l,q){q===void 0&&(q=l),r[q]=d[l]}),a=_&&_.__exportStar||function(r,d){for(var l in r)l!=="default"&&!Object.prototype.hasOwnProperty.call(d,l)&&t(d,r,l)};Object.defineProperty(e,"__esModule",{value:!0}),a(J,e),a(ke,e),a(Be,e),a($,e),a(ue,e),a(Se,e),a(ge,e),a(je,e),a(S,e)})(Lt);const te=new Lt.System,Gr=e=>{te.insert(e),te.updateBody(e)},zr=e=>{te.remove(e)},I=(e,t,a)=>{const r=new Lt.Box(e,t,a);return Gr(r),r},Dr=new Z,Xt=document.querySelector("#room5 .wallBtnWrap"),Bi=()=>{ve("room5WallBtn"),jr(),L()},Ur=({code:e})=>{e==="KeyE"&&(Xt.classList.add("pressed"),m.play("wall_btn_press"),setTimeout(()=>{m.play("glassWallSound")},500),Bi(),Dr.broadcast())},Si=()=>{Xt.classList.add("active"),document.addEventListener("keydown",Ur),H("press E")},jr=()=>{Xt.classList.remove("active"),document.removeEventListener("keydown",Ur),L()};R("room5WallBtn",{isActive:!1,maxX:950,minX:600,maxZ:3600,minZ:3350,activationCallback:Si,deactivationCallback:jr});I({x:-800,y:-730},2800,200);I({x:-700,y:-730},200,4500);I({x:500,y:200},200,750);I({x:500,y:200},430,200);I({x:500,y:800},500,200);I({x:910,y:600},200,500);I({x:1900,y:-730},200,1500);I({x:2e3,y:700},-1200,200);I({x:900,y:800},200,-900);const Nr=I({x:900,y:-600},200,800),Mi=()=>{zr(Nr)},Ei=()=>{Gr(Nr)};I({x:2100,y:1e3},200,1600);I({x:2200,y:2450},-1250,100);I({x:2200,y:1e3},-1250,100);const Ci=I({x:920,y:1e3},200,1600),Wi=()=>{zr(Ci)};Dr.subscribe(Wi);I({x:920,y:2500},200,1200);I({x:-600,y:3550},1600,200);const Yi=I({x:-600,y:2650},1600,300),Ii=()=>{Yi.setPosition(-200,2650)};ft.subscribe(Ii);const Ht=50,Vr=document.getElementById("bugSpell");let Rt=!1;const Ti=()=>{document.addEventListener("keydown",Hr)},Pi=()=>{document.removeEventListener("keydown",Hr)},Hr=({code:e})=>{e==="KeyR"&&(Rt?Li():Xi())},Li=()=>{Rt=!1,m.play("transformSpell"),gt(16),Vr.style.opacity="0.5",Un(),Xr(),pr(),Ue(),Ei(),nr()&&ar()},Xi=()=>{if(kr()<Ht){wr(),m.play("notEnoughMana");return}Rt=!0,m.play("transformSpell"),Br(Ht),gt(-420),Vr.style.opacity="1",jn(),Rr(),gs(),dr(),hn(),Mi(),nr()&&os()},Jr=document.getElementById("hpBar");let fe=0;const Kr=()=>{Jr.animate([{opacity:.5},{opacity:1},{opacity:.5}],{duration:500})},Ri=e=>{fe=e,Kr(),_r()},Oi=e=>{fe+=e,fe>100&&(fe=100),Kr(),_r()},_r=()=>{Jr.style.setProperty("--hpValue",`${fe}%`)},Zi=document.getElementById("healSpell"),Jt=70,Qi=()=>{document.addEventListener("keydown",$r)},Fi=()=>{document.removeEventListener("keydown",$r)},Gi=()=>{Zi.animate([{opacity:.5},{opacity:1},{opacity:.5}],{duration:500})},$r=({code:e})=>{if(e==="KeyT"){if(kr()<Jt){wr(),m.play("notEnoughMana");return}Br(Jt),Oi(40),Gi(),m.play("healSpell")}},eo=document.getElementById("lvl1EndScreen"),to=eo.querySelector(".close"),zi=()=>{Ps(),Mr(),Pt(!1),Pi(),Fi(),Te.stop(),Xe.stop(),Le.stop(),Pe.stop(),is(),Ms(),Mn(),eo.classList.remove("hide"),m.loop("lvlEnd",!0),m.play("lvlEnd")},Di=()=>{m.play("menuButtonClick"),location.reload()},Ui=()=>{be.play("menuButtonHover")};to.addEventListener("mouseover",Ui);to.addEventListener("click",Di);const ji=()=>{m.loop("portalRoomSound",!0),m.play("portalRoomSound")},ao=()=>{m.loop("portalRoomSound",!1),m.stop("portalRoomSound")};R("room3portalRoomSound",{isActive:!1,maxX:2200,minX:950,maxZ:2500,minZ:1050,activationCallback:ji,deactivationCallback:ao});const Ni=()=>{ao(),zi()};R("room3PortalEntering",{isActive:!1,maxX:2200,minX:2100,maxZ:2100,minZ:1300,activationCallback:Ni,deactivationCallback:()=>{}});R("room5Torch",{isActive:!1,maxX:-150,minX:-500,maxZ:3500,minZ:2500,activationCallback:sr,deactivationCallback:ir});R("room5FloorBug",{isActive:!1,maxX:450,minX:-100,maxZ:3250,minZ:2900,activationCallback:St,deactivationCallback:Mt});R("room5ShieldBug",{isActive:!1,maxX:950,minX:750,maxZ:3250,minZ:2900,activationCallback:St,deactivationCallback:Mt});const Vi=document.getElementById("bugSpell"),Ot=document.querySelector("#room4 .spell1"),Zt=({code:e})=>{e==="KeyE"&&(document.removeEventListener("keydown",Zt),ve("room4BugSpell"),L(),Ot.remove(),Vi.classList.remove("hide"),m.play("pickingSpell"),Ti())},Hi=()=>{Ot.style.filter="brightness(0.8)",document.addEventListener("keydown",Zt),H("press E")},Ji=()=>{Ot.style.filter="brightness(0.5)",document.removeEventListener("keydown",Zt),L()};R("room4BugSpell",{isActive:!1,maxX:100,minX:-550,maxZ:2300,minZ:1300,activationCallback:Hi,deactivationCallback:Ji});const Ki=document.getElementById("healSpell"),Qt=document.querySelector("#room2 .spell1"),Ft=({code:e})=>{e==="KeyE"&&(document.removeEventListener("keydown",Ft),ve("room2HealSpell"),L(),Qt.remove(),Ki.classList.remove("hide"),m.play("pickingSpell"),Qi())},_i=()=>{Qt.style.filter="brightness(0.8)",document.addEventListener("keydown",Ft),H("press E")},$i=()=>{Qt.style.filter="brightness(0.5)",document.removeEventListener("keydown",Ft),L()};R("room2HealSpell",{isActive:!1,maxX:0,minX:-550,maxZ:50,minZ:-570,activationCallback:_i,deactivationCallback:$i});let ro;const oo=()=>ro,el=()=>{ro=I({x:0,y:0},2,2)},no=new Z,so=()=>{requestAnimationFrame(so);const e=Ba(),t=tn(),a=Sa();no.broadcast({x:e,y:t,z:a})};requestAnimationFrame(so);const tl=()=>{const e=oo();te.updateBody(e),te.getPotentials(e).forEach(t=>{te.checkCollision(e,t)&&al(te.response)})},al=e=>{!e.overlap||(e.overlapV.x&&de(ne()-e.overlapV.x),e.overlapV.y&&ce(se()-e.overlapV.y))},rl=({x:e,z:t})=>{var a;(a=oo())==null||a.setPosition(e,t),tl()},ol=()=>{no.subscribe(rl)},nt=document.querySelector("#room2 .bugWrap2"),nl=()=>{nt.classList.add("moving","move"),nt.addEventListener("animationend",()=>{nt.classList.remove("moving")})},st="rotateX(270deg) rotateY(0deg) translateX(800px) translateZ(687px) translateY(-360px)",Kt="rotateX(330deg) rotateY(0deg) translateX(800px) translateZ(687px) translateY(-180px)",_t="rotateX(330deg) rotateY(-50deg) translateX(800px) translateZ(687px) translateY(-180px)",$t="rotateX(330deg) rotateY(35deg) translateX(800px) translateZ(687px) translateY(-180px)",ea="rotateX(300deg) rotateY(65deg) translateX(800px) translateZ(687px) translateY(-180px)",ta="rotateX(288deg) rotateY(0deg) translateX(800px) translateZ(687px) translateY(-180px)",aa="rotateX(288deg) rotateY(0deg) translateX(800px) translateZ(687px) translateY(16px)",sl="rotateX(360deg) rotateY(0deg) translateX(800px) translateZ(687px) translateY(16px)",il=document.getElementById("camera"),K=(e,t,a)=>il.animate([{transform:e},{transform:t}],{duration:a,easing:"ease"}).finished,ll=e=>io.animate([{backgroundColor:"black"},{backgroundColor:"transparent"}],{duration:e,easing:"ease",fill:"forwards"}).finished,io=document.getElementById("sceneScreen"),Al=async()=>{ll(2e3),await K(st,st,1e3),await K(st,Kt,2e3),await K(Kt,_t,3e3),await K(_t,$t,3e3),await K($t,ea,1e3),await K(ea,ta,1e3),await K(ta,aa,1e3),nl(),await K(aa,sl,1e3),io.classList.add("transparent")},Ne=document.getElementById("subPanelsSection"),lo={controlsSection:document.getElementById("controlsSection")};let Oe=null;const dl=()=>{Ne.classList.remove("hide")},cl=()=>{Ne.classList.add("hide")},pl=e=>{const t=lo[e];if(!t)throw`unknown sub panel - ${e}`;t.classList.remove("hide"),Oe=e},gl=e=>{const t=lo[e];if(!t)throw`unknown sub panel - ${e}`;t.classList.add("hide"),Oe=e},Gt=e=>{pl(e),dl()},ul=e=>{gl(e),cl()},ml=({target:e})=>{!e.classList.contains("subPanelsSection_closeButton")||(ul(Oe),Oe=null,m.play("menuButtonClick"))};Ne.addEventListener("click",ml);const hl=({target:e})=>{!e.classList.contains("subPanelsSection_closeButton")||be.play("menuButtonHover")};Ne.addEventListener("mouseover",hl);const ra=document.getElementById("infoIcon"),fl=e=>{e.stopPropagation(),m.play("menuButtonClick"),Gt("controlsSection")},xl=()=>{be.play("menuButtonHover")},ql=({code:e})=>{e==="KeyI"&&(Mr(),m.play("menuButtonClick"),Gt("controlsSection"))},bl=()=>{ra.addEventListener("mouseover",xl),ra.addEventListener("click",fl),window.addEventListener("keydown",ql)},yl=document.getElementById("UISection"),vl=()=>{yl.classList.remove("hide")};let Ao=!1;const wl=e=>{Ao=e};Re.subscribe(wl);const kl=async()=>{Yt(),Ts(),Ri(40),ks(0),el(),ol(),m.play("awakeningOST"),await Al(),zs(),pr(),Pt(Ao),bl(),Ss(),vl(),Sn()},Bl=document.getElementById("gameSection"),Sl=()=>{Bl.classList.remove("hide")},Ve=document.getElementById("menu"),Ml=()=>{Ve.classList.add("hide"),m.loop("menuBg",!1),m.stop("menuBg")},El=()=>{m.loop("menuBg",!0),m.play("menuBg"),Ve.classList.remove("hide")},Cl=({target:e})=>{!e.classList.contains("menu_button")||be.play("menuButtonHover")},Wl=({target:e})=>{if(!e.classList.contains("menu_button"))return;const t=e.getAttribute("action");switch(m.play("menuButtonClick"),t){case"startGame":{ia("press Esc to enable cursor"),Aa(),xo(),Sl(),Ml(),setTimeout(()=>{la(),kl()},3e3);return}case"openControlsSubPanel":{Gt("controlsSection");return}default:throw"menu button with unknown action"}};Ve.addEventListener("click",Wl);Ve.addEventListener("mouseover",Cl);const Yl=()=>{El(),la(),qo()},Il=()=>{ia("click to continue"),Aa(),window.addEventListener("click",Yl,{once:!0})};window.addEventListener("load",Il);const Tl=e=>{!(e.code==="NumpadAdd"&&e.ctrlKey)&&!(e.code==="NumpadSubtract"&&e.ctrlKey)||e.preventDefault()};window.addEventListener("keydown",Tl);const Pl=e=>{!e.ctrlKey||e.preventDefault()};window.addEventListener("wheel",Pl,{passive:!1});const Ll=e=>{e.preventDefault()};window.addEventListener("contextmenu",Ll);const Xl=document.getElementById("camera"),co=()=>{requestAnimationFrame(co),Xl.style.transform=`
    rotateX(${ba()}deg) 
    rotateY(${qa()}deg) 
    translateX(${ne()}px) 
    translateZ(${se()}px)
    translateY(${xa()}px)
  `};requestAnimationFrame(co);const Rl=document.getElementById("scenesWrap"),po=()=>{requestAnimationFrame(po),Rl.style.transform=`
    translateX(${Zs()}px) 
    translateZ(${Qs()}px)
    translateY(${It()}px)
    rotateY(180deg)
  `};requestAnimationFrame(po);const He=new Z,Ol=({newRealAngleX:e,newRealAngleY:t,newNormalizedAngleX:a,newNormalizedAngleY:r})=>{const d=Zl(t),l=ae(a),q=Ql(t,d,r);Jo(e),Ko(d),_o(l),$o(q),He.broadcast({realAngleX:e,realAngleY:d,newNormalizedAngleX:l,newNormalizedAngleY:q})},oa=60,na=-60,Zl=e=>e>oa?oa:e<na?na:e,Ql=(e,t,a)=>e!==t?ya():ae(a);Ma.subscribe(Ol);const Fl=({newNormalizedAngleX:e})=>{const{x:t,z:a}=ut(ae(e-180));Yn(t),In(a)};He.subscribe(Fl);const Gl=({newNormalizedAngleX:e})=>{const{x:t,z:a}=ut(ae(e));Cn(t),Wn(a)};He.subscribe(Gl);const zl=({newNormalizedAngleX:e})=>{const{x:t,z:a}=ut(ae(e-90));Tn(t),Pn(a)};He.subscribe(zl);const go=new Z,Ze=Qa()/-3.75;let Ae=!1;const Dl=e=>{if(Ul(e)){if(Ae)return;Vl()}else{if(!Ae)return;Hl()}},Ul=e=>e.forward||e.backward?e.right||e.left:!1,jl=()=>{Qe(P().stepSizeX+Ze),Fe(P().stepSizeZ+Ze)},Nl=()=>{Qe(P().stepSizeX-Ze),Fe(P().stepSizeZ-Ze)},Vl=()=>{Ae=!0,jl(),go.broadcast(Ae)},Hl=()=>{Ae=!1,Nl(),go.broadcast(Ae)};we.subscribe(Dl);const Jl={forward:()=>{re.startMove("forward")},backward:()=>{re.startMove("backward")},right:()=>{oe.startMove("right")},left:()=>{oe.startMove("left")}},Kl={forward:"backward",backward:"forward",right:"left",left:"right"},_l=e=>{if(e[e.changed])return;const t=Kl[e.changed];e[t]&&Jl[t]()};we.subscribe(_l);tr();
